{"version":3,"file":"ngrx-data-pagination.js","sources":["ng://ngrx-data-pagination/lib/pagination/store-interfaces/ngrx/default-store-key.ts","ng://ngrx-data-pagination/lib/pagination/iterator/pagination-function.ts","ng://ngrx-data-pagination/lib/pagination/iterator/async-page-generator.ts","ng://ngrx-data-pagination/lib/pagination/iterator/page-iterator.ts","ng://ngrx-data-pagination/lib/pagination/store/actions.ts","ng://ngrx-data-pagination/lib/pagination/store/selectors.ts","ng://ngrx-data-pagination/lib/pagination/store/state.ts","ng://ngrx-data-pagination/lib/pagination/store-interfaces/store-pagination-context.ts","ng://ngrx-data-pagination/lib/pagination/store-interfaces/ngrx/selectors.ts","ng://ngrx-data-pagination/lib/pagination/store-interfaces/ngrx/pagination.ts","ng://ngrx-data-pagination/lib/pagination/store-interfaces/ngrx/pagination-factory.service.ts","ng://ngrx-data-pagination/lib/pagination/store/reducer.ts","ng://ngrx-data-pagination/lib/pagination/store-interfaces/ngrx/pagination.module.ts"],"sourcesContent":["export const defaultStoreKey = 'ngrxDataPagination';\n","import { Observable } from 'rxjs';\n\nexport type PaginationFunctionCurried<Entity, State, QueryOptions> = (\n  queryOptions: QueryOptions,\n) => (\n  prevState?: State,\n) => Observable<{\n  nextState: State;\n  data: Entity[];\n}>;\n\nexport interface Page<Entity, State> {\n  state: State;\n  data: Entity[];\n  done: boolean;\n}\n\nexport type PaginationFunction<Entity, State = any> = (\n  prevState?: State,\n) => Promise<Page<Entity, State>>;\n\nexport type ObservablePaginationFunction<Entity, State> = (\n  prevState?: State,\n) => Observable<Page<Entity, State>>;\n\nexport const observableToPromisePaginationFunction = <Entity, State>(\n  observableFn: ObservablePaginationFunction<Entity, State>,\n): PaginationFunction<Entity, State> => (prevState?: State) =>\n  observableFn(prevState).toPromise();\n","import { Page, PaginationFunction } from './pagination-function';\n\n// TODO fix TS setup for AsyncPageGenerator types\n\n// export type AsyncPageGenerator<Entity> = AsyncGenerator<Entity[], Entity[], any>;\n\nexport async function* asyncPageGenerator<Entity, State>(\n  paginationFunction: PaginationFunction<Entity, State>,\n) {\n  // : AsyncGenerator<Entity[], Entity[], any>\n  let page: Page<Entity, State> = {\n    data: undefined,\n    state: undefined,\n    done: false,\n  };\n\n  while (true) {\n    page = await paginationFunction(page.state);\n    if (page.done) {\n      return page.data;\n    }\n    yield page.data;\n  }\n}\n\n// export const examplePaginationFunction: PaginationFunction<number, number> = state =>\n//   Promise.resolve({ data: [state], state: state + 1, done: false, });\n\n// export const exampleAsyncPageGenerator = asyncPageGenerator(examplePaginationFunction);\n\n// const f = async () => {\n//   for await (const page of exampleAsyncPageGenerator) {\n//     console.log('page', page);\n//   }\n// };\n","import { asyncPageGenerator } from './async-page-generator';\nimport { PaginationFunction } from './pagination-function';\n\nexport class PageIterator<Entity> {\n  private asyncPageGenerator: any; //  AsyncPageGenerator<Entity>;\n  public done = false;\n  private pending = false;\n\n  constructor(paginationFunction: PaginationFunction<Entity>) {\n    this.asyncPageGenerator = asyncPageGenerator(paginationFunction);\n  }\n\n  async getNextPage(): Promise<Entity[]> {\n    if (this.pending) {\n      throw new Error('cannot queue pages (yet)');\n    }\n\n    if (this.done) {\n      throw new Error('This PageIterator is done. Try creating a new one');\n    }\n\n    this.pending = true;\n\n    const { value, done } = await this.asyncPageGenerator.next();\n\n    this.pending = false;\n    this.done = done;\n    return value;\n  }\n\n  [Symbol.asyncIterator] = () => this.asyncPageGenerator;\n}\n","import { EntityId } from '../entity';\n\nexport enum PaginationActionType {\n  RESET_PAGINATION_STATE = '[mb-Pagination] Reset Pagination State',\n  GET_NEXT_PAGE = '[mb-Pagination] Get Next Page',\n  GET_NEXT_PAGE_SUCCESS = '[mb-Pagination] Get Next Page Success',\n  GET_NEXT_PAGE_EMPTY = '[mb-Pagination] Get Next Page Empty',\n  PREV_PAGE = '[mb-Pagination] Prev Page',\n  NEXT_PAGE = '[mb-Pagination] Next Page',\n}\n\nconst T = PaginationActionType;\n\ninterface Action {\n  type: string;\n}\n\nexport interface PaginationActionT extends Action {\n  type: PaginationActionType;\n  contextId: string;\n}\n\nexport class ResetPaginationState implements PaginationActionT {\n  readonly type = T.RESET_PAGINATION_STATE;\n  constructor(public contextId: string) {}\n}\nexport class GetNextPage implements PaginationActionT {\n  readonly type = T.GET_NEXT_PAGE;\n  constructor(public contextId: string) {}\n}\nexport class GetNextPageSuccess implements PaginationActionT {\n  readonly type = T.GET_NEXT_PAGE_SUCCESS;\n  constructor(\n    public contextId: string,\n    public entityIds: EntityId[],\n    public done: boolean,\n  ) {}\n}\nexport class GetNextPageEmpty implements PaginationActionT {\n  readonly type = T.GET_NEXT_PAGE_EMPTY;\n  constructor(\n    public contextId: string\n  ) {}\n}\nexport class PrevPage implements PaginationActionT {\n  readonly type = T.PREV_PAGE;\n  constructor(public contextId: string) {}\n}\nexport class NextPage implements PaginationActionT {\n  readonly type = T.NEXT_PAGE;\n  constructor(public contextId: string) {}\n}\n\nexport type PaginationAction =\n  | ResetPaginationState\n  | GetNextPage\n  | GetNextPageSuccess\n  | GetNextPageEmpty\n  | PrevPage\n  | NextPage;\n\nexport const makeActionCreators = (contextId: string) => ({\n  ResetPaginationState: () => new ResetPaginationState(contextId),\n  GetNextPage: () => new GetNextPage(contextId),\n  GetNextPageSuccess: (entityIds: EntityId[], done: boolean) =>\n    new GetNextPageSuccess(contextId, entityIds, done),\n  GetNextPageEmpty: () => new GetNextPageEmpty(contextId),\n  PrevPage: () => new PrevPage(contextId),\n  NextPage: () => new NextPage(contextId),\n});\n\nexport const makeDispatchers = (\n  contextId: string,\n  dispatch: (action: Action) => void,\n) => {\n  const actionCreators = makeActionCreators(contextId);\n\n  return {\n    ResetPaginationState: () => dispatch(actionCreators.ResetPaginationState()),\n    GetNextPage: () => dispatch(actionCreators.GetNextPage()),\n    GetNextPageSuccess: (entityIds: EntityId[], done: boolean) =>\n      dispatch(actionCreators.GetNextPageSuccess(entityIds, done)),\n    GetNextPageEmpty: () => dispatch(actionCreators.GetNextPageEmpty()),\n    PrevPage: () => dispatch(actionCreators.PrevPage()),\n    NextPage: () => dispatch(actionCreators.NextPage()),\n  };\n};\n","import { EntityId } from '../entity';\nimport { PaginationContextState } from './state';\n\nconst finalPageIndex = ({ done, pages }: PaginationContextState): number => {\n  if (!done || !pages || !pages.length) {\n    return null;\n  }\n\n  return pages.length - 1;\n};\n\nconst flatten = <A>(arrays: A[][]): A[] => arrays.reduce((result, as) => result.concat(as))\n\nexport const contextSelectors = {\n  currentPageIds: ({\n    pages,\n    currentPage,\n  }: PaginationContextState): EntityId[] => (pages ? pages[currentPage] : null),\n  allIds: ({ pages }: PaginationContextState): EntityId[] => flatten(pages),\n  allPageIds: ({ pages }: PaginationContextState): EntityId[][] => pages,\n  nextPageLoaded: ({ pages, currentPage }: PaginationContextState): boolean =>\n    !!pages[currentPage + 1],\n  nextPageLoading: ({\n    pages,\n    currentPage,\n    loadingNewPage,\n  }: PaginationContextState): boolean => {\n    if (!Number.isInteger(currentPage)) {\n      return loadingNewPage;\n    }\n    return !pages[currentPage + 1] && loadingNewPage;\n  },\n  loadingNewPage: ({ loadingNewPage }: PaginationContextState): boolean =>\n    loadingNewPage,\n  pageNumber: ({ currentPage }: PaginationContextState): number =>\n    currentPage >= 0 ? currentPage : null,\n  done: ({ done }: PaginationContextState) => done,\n  finalPageIndex,\n  onFirstPage: ({ currentPage }: PaginationContextState) => currentPage === 0,\n  onFinalPage: (state: PaginationContextState) => {\n    const { currentPage } = state;\n    const finalIndex = finalPageIndex(state);\n\n    if (typeof finalIndex !== 'number' || typeof currentPage !== 'number') {\n      return false;\n    }\n\n    return currentPage === finalIndex;\n  },\n};\n\nexport type ContextSelectors = typeof contextSelectors;\n","import { EntityId } from '../entity';\n\nexport interface PaginationContextState {\n  // storing entity ids instead of enities allows the programmer\n  // to teardown resources separately from pagination\n  pages: EntityId[][];\n  loadingNewPage: boolean;\n  currentPage: number;\n  done: boolean;\n  progressionCancelled: boolean; // cancels the automatic page progression when a new page is loaded\n}\n\nexport interface PaginationState {\n  contexts: { [contextId: string]: PaginationContextState };\n}\n\nexport const defaultPaginationContextState: PaginationContextState = {\n  pages: [],\n  loadingNewPage: false,\n  currentPage: -1,\n  done: false,\n  progressionCancelled: false,\n};\n\nexport const defaultPaginationState: PaginationState = { contexts: {} };\n","import { combineLatest, Observable, Subscription } from 'rxjs';\nimport { map, shareReplay } from 'rxjs/operators';\nimport { AnyEntity, EntityMap } from '../entity';\nimport { PageIterator } from '../iterator/page-iterator';\nimport { PaginationFunction } from '../iterator/pagination-function';\nimport { makeDispatchers, PaginationActionT } from '../store/actions';\nimport { contextSelectors } from '../store/selectors';\nimport {\n  defaultPaginationContextState,\n  PaginationContextState,\n  PaginationState,\n} from '../store/state';\n\n// assumes paginator reducer is plugged in\n\n/**\n * This is a pagination context usable with Redux, ngrx, or\n * any other similar implementations. It writes to, but does\n * not read from the store. It assumes:\n * 1. `dispatch` dispatches an action to the store\n * 2. TODO this library's reducer has been installed\n */\nexport class StorePaginationContext<Entity extends AnyEntity> {\n  private pageIterator: PageIterator<Entity>;\n  private dispatchers: ReturnType<typeof makeDispatchers>;\n  private contextState = defaultPaginationContextState;\n  private contextState$: Observable<PaginationContextState>;\n  private entityMap$: Observable<EntityMap<Entity>>;\n  private subscription: Subscription;\n\n  constructor(\n    // Arbitrary. For now, only use one ReduxLikePaginationContext per contextId\n    contextId: string,\n\n    // For requesting the pages\n    paginationFunction: PaginationFunction<Entity>,\n\n    // Dispatch an action meant for the PaginationReducer\n    dispatch: (action: PaginationActionT) => void,\n\n    // Allow the programmer to store entities as they like\n    private onReceivePage: (entities: Entity[]) => void,\n\n    state$: Observable<PaginationState>,\n    entityMap$: Observable<EntityMap<Entity>>,\n  ) {\n    this.contextState$ = state$.pipe(\n      map(state =>\n        state ? state.contexts[contextId] : defaultPaginationContextState,\n      ),\n    );\n\n    this.subscription = this.contextState$.subscribe(contextState => {\n      this.contextState = contextState;\n    });\n\n    this.dispatchers = makeDispatchers(contextId, dispatch);\n    this.dispatchers.ResetPaginationState();\n    this.pageIterator = new PageIterator(paginationFunction);\n\n    this.entityMap$ = entityMap$.pipe(shareReplay(1));\n\n    // wait until next event loop in case of setup time\n    setTimeout(() => this.nextPage(), 0);\n  }\n\n  async getNextPageP(): Promise<Entity[]> {\n    const nextPageLoaded = contextSelectors.nextPageLoaded(this.contextState);\n    if (nextPageLoaded) {\n      this.incrementCurrentPage();\n      return;\n    }\n\n    if (contextSelectors.done(this.contextState)) {\n      throw new Error('Cannot get more pages after becoming done');\n    }\n\n    this.dispatchers.GetNextPage();\n    const page = await this.pageIterator.getNextPage();\n    this.onReceivePage(page);\n\n    if (!page) {\n      throw new Error('bad page in getNextPageP');\n    }\n\n    const entityIds = page.map(({ id }) => id);\n\n    if (!entityIds.length) {\n      this.dispatchers.GetNextPageEmpty();\n    } else {\n      this.dispatchers.GetNextPageSuccess(\n        entityIds,\n        this.pageIterator.done,\n      );\n    }\n\n    return page;\n  }\n\n  nextPage() {\n    this.getNextPageP();\n  }\n\n  prevPage() {\n    if (this.contextState.currentPage <= 0) {\n      throw new Error('Cannot go back from page 0');\n    }\n    this.dispatchers.PrevPage();\n  }\n\n  private incrementCurrentPage() {\n    this.dispatchers.NextPage();\n  }\n\n  get currentPage$(): Observable<Entity[] | null> {\n    return combineLatest(this.entityMap$, this.contextState$).pipe(\n      map(([entityMap, contextState]) => {\n        const currentPageIds = contextSelectors.currentPageIds(contextState);\n        if (!currentPageIds) {\n          return null;\n        }\n        return currentPageIds.map(entityId => entityMap[entityId]);\n      }),\n    );\n  }\n\n  destroy() {\n    this.subscription.unsubscribe();\n  }\n\n  [Symbol.asyncIterator] = () => this.pageIterator[Symbol.asyncIterator];\n}\n","import { Dictionary } from '@ngrx/entity';\nimport {\n  createFeatureSelector,\n  createSelector,\n  select,\n  Selector,\n  Store,\n} from '@ngrx/store';\nimport { Observable } from 'rxjs';\nimport { ContextSelectors, contextSelectors } from '../../store/selectors';\nimport { PaginationContextState, PaginationState } from '../../store/state';\nimport { defaultStoreKey } from './default-store-key';\n\n// These selections require knowledge of the entity cache\ninterface AdvancedSelections<Entity> {\n  page: Entity[] | null;\n  all: Entity[] | null;\n}\n\nexport type BasicNgrxPaginationSelectors = {\n  [K in keyof ContextSelectors]: Selector<any, ReturnType<ContextSelectors[K]>>;\n};\n\ntype AdvancedNgrxPaginationSelectors<Entity> = {\n  [K in keyof AdvancedSelections<Entity>]: Selector<\n    any,\n    AdvancedSelections<Entity>[K]\n  >;\n};\n\nexport type AllNgrxPaginationSelectors<Entity> = BasicNgrxPaginationSelectors &\n  AdvancedNgrxPaginationSelectors<Entity>;\n\nexport type BasicNgrxPaginationObservables = {\n  [K in keyof ContextSelectors]: Observable<ReturnType<ContextSelectors[K]>>;\n};\n\ntype AdvancedNgrxPaginationObservables<Entity> = {\n  [K in keyof AdvancedSelections<Entity>]: Observable<\n    AdvancedSelections<Entity>[K]\n  >;\n};\n\nexport type AllNgrxPaginationObservables<\n  Entity\n> = BasicNgrxPaginationObservables & AdvancedNgrxPaginationObservables<Entity>;\n\nconst mapValues = <A>(obj: any, f: any): { [K in keyof A]: any } => {\n  const result = {};\n\n  for (const k of Object.keys(obj)) {\n    result[k] = f(obj[k]);\n  }\n\n  return result as any;\n};\n\n/**\n * Creates pagination selectors that only know about the pagination state\n */\nconst basicPaginationSelectors = (\n  contextId: string,\n): BasicNgrxPaginationSelectors => {\n  const paginationState = createFeatureSelector<PaginationState>(\n    defaultStoreKey,\n  );\n  const contextState = createSelector(\n    paginationState,\n    s => s.contexts[contextId],\n  );\n\n  const contextSelector = <A>(f: (s: PaginationContextState) => A) =>\n    createSelector(contextState, f);\n\n  return mapValues(contextSelectors, contextSelector);\n};\n\n/**\n * Creates selectors that know about the entity cache\n */\nconst advancedPaginationSelectors = <Entity>(\n  basicPaginationSelectors: BasicNgrxPaginationSelectors,\n  selectEntityMap: Selector<any, Dictionary<Entity>>,\n): AdvancedNgrxPaginationSelectors<Entity> => {\n  return {\n    page: createSelector(\n      basicPaginationSelectors.currentPageIds,\n      selectEntityMap,\n      (ids, entityMap) => {\n        if (!ids || !entityMap) {\n          return null;\n        }\n        return ids.reduce((a, id) => {\n          if (id in entityMap) {\n            a.push(entityMap[id]);\n          }\n          return a;\n        }, []);\n      },\n    ),\n    all: createSelector(\n      basicPaginationSelectors.allIds,\n      selectEntityMap,\n      (allIds, entityMap) => {\n        if (!allIds || !entityMap) {\n          return null;\n        }\n        return allIds.map(id => entityMap[id]);\n      },\n    ),\n  };\n};\n\nexport const allPaginationSelectors = <Entity>(\n  contextId: string,\n  selectEntityMap: Selector<any, Dictionary<Entity>>,\n) => {\n  const basicSelectors = basicPaginationSelectors(contextId);\n  const advancedSelectors = advancedPaginationSelectors(\n    basicSelectors,\n    selectEntityMap,\n  );\n  return {\n    ...basicSelectors,\n    ...advancedSelectors,\n  };\n};\n\nexport const allPaginationObservables = <Entity>(\n  store: Store<any>,\n  allSelectors: AllNgrxPaginationSelectors<Entity>,\n): AllNgrxPaginationObservables<Entity> => {\n  const sel = <A>(selector: Selector<any, A>) => store.pipe(select(selector));\n  return mapValues(allSelectors, sel);\n};\n","import { EntityCollectionServiceBase, EntityOp } from '@ngrx/data';\nimport { Action, select, Store } from '@ngrx/store';\nimport { from, Observable } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { AnyEntity } from '../../entity';\nimport {\n  ObservablePaginationFunction,\n  observableToPromisePaginationFunction,\n} from '../../iterator/pagination-function';\nimport { PaginationState } from '../../store/state';\nimport { StorePaginationContext } from '../store-pagination-context';\nimport {\n  AllNgrxPaginationObservables,\n  AllNgrxPaginationSelectors,\n  allPaginationObservables,\n  allPaginationSelectors,\n} from './selectors';\n\n/**\n * Adapts `StorePaginationContext` to work with ngrx/data\n */\nexport class Pagination<Entity extends AnyEntity, NextPageState = any> {\n  private storePaginationContext: StorePaginationContext<Entity>;\n  public selectors: AllNgrxPaginationSelectors<Entity>;\n  public selectors$: AllNgrxPaginationObservables<Entity>;\n\n  constructor(\n    contextId: string,\n    paginationFunction: ObservablePaginationFunction<Entity, NextPageState>,\n    private entityService: EntityCollectionServiceBase<Entity, any>,\n    store: Store<any>,\n    ngrxDataPaginationStoreKey: string,\n    addToCache: boolean,\n  ) {\n    const dispatch = (action: Action) => store.dispatch(action);\n\n    const onReceivePage = (page: Entity[]): void => {\n      if (!addToCache) {\n        return;\n      }\n      this.entityService.upsertManyInCache(page);\n      this.entityService.createAndDispatch(EntityOp.SAVE_UPSERT_MANY_SUCCESS, page);\n    };\n\n    const paginationState$ = store.pipe(\n      select(ngrxDataPaginationStoreKey),\n    ) as Observable<PaginationState>;\n\n    const entityMap$ = entityService.selectors$.entityMap$;\n\n    this.storePaginationContext = new StorePaginationContext(\n      contextId,\n      observableToPromisePaginationFunction(paginationFunction),\n      dispatch,\n      onReceivePage,\n      paginationState$,\n      entityMap$,\n    );\n\n    this.selectors = allPaginationSelectors(\n      contextId,\n      entityService.selectors.selectEntityMap,\n    );\n    this.selectors$ = allPaginationObservables(store, this.selectors);\n  }\n\n  nextPage(): void {\n    return this.storePaginationContext.nextPage();\n  }\n\n  prevPage(): void {\n    return this.storePaginationContext.prevPage();\n  }\n\n  /** Not yet cancellable! Use with caution. */\n  _loadAllPages(): Observable<unknown> {\n    return from(this._loadAllPagesP()).pipe(take(1));\n  }\n\n  private async _loadAllPagesP() {\n    // wait until not loading\n    await this.selectors$.nextPageLoading\n      .pipe(\n        filter(loading => !loading),\n        take(1),\n      )\n      .toPromise();\n\n    // start the next-page request\n    this.nextPage();\n\n    // wait until not loading, again\n    await this.selectors$.nextPageLoading\n      .pipe(\n        filter(loading => !loading),\n        take(1),\n      )\n      .toPromise();\n\n    const done = await this.selectors$.done\n      .pipe(take(1))\n      .toPromise();\n\n    if (done) {\n      // done case: let the whole function return\n      return;\n    }\n\n    // recursive case: not done, so recurse\n    return this._loadAllPages();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntityCollectionServiceBase } from '@ngrx/data';\nimport { Store } from '@ngrx/store';\nimport { AnyEntity } from '../../entity';\nimport { ObservablePaginationFunction } from '../../iterator/pagination-function';\nimport { defaultStoreKey } from './default-store-key';\nimport { Pagination } from './pagination';\n\nexport interface PaginationFactoryArgs<\n  Entity extends AnyEntity,\n  NextPageState\n> {\n  contextId?: string;\n  paginationFunction: ObservablePaginationFunction<Entity, NextPageState>;\n  entityService: EntityCollectionServiceBase<Entity, any>;\n  addToCache?: boolean;\n}\n\n@Injectable()\nexport class PaginationFactory {\n  private counter = 0;\n\n  constructor(private store: Store<any>) {}\n\n  create<Entity extends AnyEntity, NextPageState>({\n    entityService,\n    paginationFunction,\n    addToCache = true,\n    contextId = `${entityService.entityName}-${this.counter++}`,\n  }: PaginationFactoryArgs<Entity, NextPageState>): Pagination<\n    Entity,\n    NextPageState\n  > {\n    return new Pagination(\n      contextId,\n      paginationFunction,\n      entityService,\n      this.store,\n      defaultStoreKey,\n      addToCache,\n    );\n  }\n}\n","import { PaginationAction, PaginationActionType as T } from './actions';\nimport { contextSelectors } from './selectors';\nimport {\n  defaultPaginationContextState,\n  defaultPaginationState,\n  PaginationContextState,\n  PaginationState,\n} from './state';\n\nexport function paginationContextReducer(\n  state: PaginationContextState = defaultPaginationContextState,\n  action: PaginationAction,\n): PaginationContextState {\n  switch (action.type) {\n    case T.RESET_PAGINATION_STATE:\n      return defaultPaginationContextState;\n\n    case T.GET_NEXT_PAGE:\n      return {\n        ...state,\n        loadingNewPage: true,\n        progressionCancelled: false,\n      };\n\n    case T.GET_NEXT_PAGE_SUCCESS:\n      return {\n        ...state,\n        loadingNewPage: false,\n        pages: [...state.pages, action.entityIds],\n        currentPage: state.progressionCancelled\n          ? state.currentPage\n          : state.currentPage + 1,\n        done: action.done,\n        progressionCancelled: false,\n      };\n\n    case T.GET_NEXT_PAGE_EMPTY:\n      const isFirstFetchedPage = (state.pages.length === 0);\n      return {\n        ...state,\n        loadingNewPage: false,\n        pages: isFirstFetchedPage ? [[]] : [...state.pages],\n        currentPage: state.progressionCancelled && !isFirstFetchedPage\n          ? state.currentPage\n          : state.currentPage + 1,\n        done: true,\n        progressionCancelled: false,\n      };\n\n    case T.PREV_PAGE:\n      return {\n        ...state,\n        currentPage: state.currentPage - 1,\n        // If the next page is loading when the user goes back,\n        // don't progress the page number when the page comes in\n        progressionCancelled: contextSelectors.nextPageLoading(state),\n      };\n\n    case T.NEXT_PAGE:\n      return {\n        ...state,\n        currentPage: state.currentPage + 1,\n      };\n\n    default:\n      return state;\n  }\n}\n\nexport function paginationReducer(\n  state: PaginationState = defaultPaginationState,\n  action: PaginationAction,\n): PaginationState {\n  if (!action || !action.type.startsWith('[mb-Pagination]')) {\n    return state;\n  }\n\n  return {\n    ...state,\n    contexts: {\n      ...state.contexts,\n      [action.contextId]: paginationContextReducer(\n        state.contexts[action.contextId],\n        action,\n      ),\n    },\n  };\n}\n","import {\n  Inject,\n  ModuleWithProviders,\n  NgModule,\n  Optional,\n  SkipSelf,\n} from '@angular/core';\nimport { StoreModule } from '@ngrx/store';\nimport { paginationReducer } from '../../store/reducer';\nimport { defaultStoreKey } from './default-store-key';\nimport { PaginationFactory } from './pagination-factory.service';\n\nconst NGRX_DATA_PAGINATION_STORE_KEY = 'NGRX_DATA_PAGINATION_STORE_KEY';\n\n@NgModule({\n  declarations: [],\n  imports: [StoreModule.forFeature(defaultStoreKey, paginationReducer)],\n  exports: [],\n  providers: [PaginationFactory],\n})\nexport class PaginationModule {\n  constructor(\n    @Optional() @SkipSelf() parentModule: PaginationModule,\n    @Optional() @Inject(NGRX_DATA_PAGINATION_STORE_KEY) storeKey: string,\n  ) {\n    if (parentModule) {\n      throw new Error(\n        'PaginationModule is already loaded. Import it in the root module (usually the AppModule) only',\n      );\n    }\n    if (!storeKey) {\n      throw new Error(\n        'ngrx-data-pagination requires PaginationModule.forRoot() to be imported',\n      );\n    }\n  }\n\n  /**\n   * `storeKey` doesn't actually work yet`\n   */\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: PaginationModule,\n      providers: [\n        {\n          provide: NGRX_DATA_PAGINATION_STORE_KEY,\n          useValue: defaultStoreKey,\n        },\n      ],\n    };\n  }\n}\n"],"names":["T"],"mappings":"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"}